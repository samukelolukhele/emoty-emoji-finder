{"ast":null,"code":"\"use strict\";\n\nvar DOMException = require(\"domexception/webidl2js-wrapper\");\n\nvar MessageEvent = require(\"./generated/MessageEvent\");\n\nvar idlUtils = require(\"./generated/utils\");\n\nvar _require = require(\"../utils\"),\n    isValidTargetOrigin = _require.isValidTargetOrigin;\n\nvar _require2 = require(\"./helpers/events\"),\n    fireAnEvent = _require2.fireAnEvent;\n\nmodule.exports = function (globalObject) {\n  return function (message, targetOrigin) {\n    var _this = this;\n\n    if (arguments.length < 2) {\n      throw new TypeError(\"'postMessage' requires 2 arguments: 'message' and 'targetOrigin'\");\n    }\n\n    targetOrigin = String(targetOrigin);\n\n    if (!isValidTargetOrigin(targetOrigin)) {\n      // TODO: Fix me\n      throw DOMException.create(globalObject, [\"Failed to execute 'postMessage' on 'Window': \" + \"Invalid target origin '\" + targetOrigin + \"' in a call to 'postMessage'.\", \"SyntaxError\"]);\n    } // TODO: targetOrigin === '/' - requires reference to source window\n    // See https://github.com/jsdom/jsdom/pull/1140#issuecomment-111587499\n\n\n    if (targetOrigin !== \"*\" && targetOrigin !== idlUtils.implForWrapper(globalObject._document)._origin) {\n      return;\n    } // TODO: event.source - requires reference to source window\n    // TODO: event.origin - requires reference to source window\n    // TODO: event.ports\n    // TODO: event.data - structured clone message - requires cloning DOM nodes\n\n\n    setTimeout(function () {\n      fireAnEvent(\"message\", _this, MessageEvent, {\n        data: message\n      });\n    }, 0);\n  };\n};","map":null,"metadata":{},"sourceType":"script"}